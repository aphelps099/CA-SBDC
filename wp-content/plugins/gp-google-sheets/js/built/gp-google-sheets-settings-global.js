(()=>{"use strict";var t={n:e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},d:(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};const e=window.jQuery;var n=t.n(e),o="gpgs_google_oauth_data",s="gpgs_google_picker_data";function a(t){var e=t.ms,n=void 0===e?1e3:e,o=t.itemKey,s=t.handleItem,a=setInterval((function(){var t=localStorage.getItem(o);t&&(clearInterval(a),s(t))}),n)}function c(t){var e=t.oAuthServiceUrl,o=t.inputs,s=t.id,a=void 0===s?"gpgs_oauth_form":s;n()('<form\n\t\t\tid="'.concat(a,'"\n\t\t\taction="').concat(e,'"\n\t\t\tmethod="POST"\n\t\t\ttarget="tab"\n\t\t>\n\t\t\t').concat(o.map((function(t){var e=t[0],n=t[1].replace(/"/g,"&quot;");return'<input type="hidden" name="'.concat(e,'" value="').concat(n,'">')})),"\n\t\t</form>")).appendTo("body").submit()}var r=function(t,e,n,o){return new(n||(n=Promise))((function(s,a){function c(t){try{i(o.next(t))}catch(t){a(t)}}function r(t){try{i(o.throw(t))}catch(t){a(t)}}function i(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,r)}i((o=o.apply(t,e||[])).next())}))},i=function(t,e){var n,o,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function r(r){return function(i){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,r[0]&&(c=0)),c;)try{if(n=1,o&&(s=2&r[0]?o.return:r[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,r[1])).done)return s;switch(o=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return c.label++,{value:r[1],done:!1};case 5:c.label++,o=r[1],r=[0];continue;case 7:r=c.ops.pop(),c.trys.pop();continue;default:if(!((s=(s=c.trys).length>0&&s[s.length-1])||6!==r[0]&&2!==r[0])){c=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){c.label=r[1];break}if(6===r[0]&&c.label<s[1]){c.label=s[1],s=r;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(r);break}s[2]&&c.ops.pop(),c.trys.pop();continue}r=e.call(t,c)}catch(t){r=[6,t],o=0}finally{n=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,i])}}},g=window.gpgs_settings_plugin_strings;function _(){n()("#gpgs_connect_to_google_button").remove(),n()("#gform_setting_connect_button").append('<div id="gpgs_connect_to_google_button" class="">\n\t\t\t<button onclick="return false;" class="gform_settings_button button" id="plugin_connect">\n\t\t\t\t'.concat(g.connect,'\n\t\t\t\t<span class="spinner spinner_connect"></span>\n\t\t\t</button>\n\t\t</div>')),p(),d(),n()("#plugin_connect").on("click.gpgsConnectButton",(function(){n()(".spinner.spinner_connect").addClass("is-active");var t={oauth_random_string:g.oauth_random_string,oauth_validation_token:g.oauth_validation_token,user_id:g.user_id};c({oAuthServiceUrl:"".concat(g.gwiz_oauth_service_url,"/oauth/google"),inputs:[["redirectUrl","".concat(g.ajax_url,"?action=gpgs_plugin_settings_oauth_callback")],["licenseId",g.gravity_perks_license_id],["licenseHash",g.gravity_perks_license_hash],["perkId",g.slug],["siteUrl",g.site_url],["state",JSON.stringify(t)]]});var e="".concat(o,"_").concat(g.oauth_random_string);a({itemKey:e,handleItem:function(t){localStorage.removeItem(e);var o=JSON.parse(t);if("0"===o.success)return n()("#plugin_connect > span").removeClass("is-active"),void u(o.message);g.token=o.token,p(),n()("#plugin_connect > span").removeClass("spinner_connect").addClass("spinner_disconnect"),g.token_is_legacy="",l(),b(),k()}})}))}function l(){n()("#gpgs_connect_to_google_button").remove();var t=g.connected_to_google,e=g.token_is_legacy?'<span id="gpgs_connect_to_google_legacy_warning">'.concat(v," ").concat(g.legacy_token,"</span>"):"",o='<div id="gpgs_connect_to_google_button" class="alert gforms_note_success" style="\n\t    display: flex;\n\t    align-items: center;\n\t">\n\t\t<span id="gpgs_connected_to_google">'.concat(t,"</span>\n\t\t").concat(e,'\n\t\t<button onclick="return false;" class="gform_settings_button button" id="plugin_disconnect" style="\n\t\t    align-self: self-end;\n\t\t">\n\t\t\t').concat(g.disconnect,'\n\t\t\t<span class="spinner spinner_connect"></span>\n\t\t</button>\n\t</div>');n()("#gform_setting_connect_button").append(o),p(),d(),n()("#plugin_disconnect").on("click.gpgsDisconnectButton",(function(){if(confirm("Are you sure you want to disconnect? Doing so might unintentionally break existing feeds.")){n()(".spinner.spinner_disconnect").addClass("is-active");var t={action:"gpgs_disconnect_plugin",_ajax_nonce:g.nonce};jQuery.post(g.ajax_url,t,(function(t){t.success&&(n()("#plugin_disconnect,.tooltip_google_sheet_disconnect").remove(),_(),n()("#gform_setting_client_id .gform-settings-input__container").removeClass("gform-settings-input__container--feedback-success"),n()("#gform_setting_client_secret .gform-settings-input__container").removeClass("gform-settings-input__container--feedback-success"),b(),k()),n()(".spinner.spinner_disconnect").removeClass("is-active")}))}}))}function u(t){n()("#gf-admin-notices-wrapper").append('<div class="notice notice-error gf-notice"><p><strong>'.concat(g.error_authenticating_with_google," ").concat(t,"</strong></p></div>"))}function p(){n()("#plugin_connect").off("click.gpgsConnectButton")}function d(){n()("#plugin_disconnect").off("click.gpgsDisconnectButton")}function h(t,e){return void 0===e&&(e=""),'<span class="gpgs_status_icon" style="background-image: url(\''.concat(t,"');\">").concat(e,"</span>")}var f=h("".concat(g.site_url,"/wp-content/plugins/gp-google-sheets/assets/green-checkmark.svg"),"Connected"),m=h("".concat(g.site_url,"/wp-content/plugins/gp-google-sheets/assets/red-x.svg"),"Disconnected"),v=h("".concat(g.site_url,"/wp-content/plugins/gp-google-sheets/assets/warning.svg"),"Warning");function k(){return r(this,void 0,void 0,(function(){var t,e;return i(this,(function(o){switch(o.label){case 0:return n()("#gp-google-sheets-add-spreadsheet").off(".gpgsGppaSection"),g.token?(t={action:"gpgs_get_spreadsheets_markup",_ajax_nonce:g.nonce},[4,jQuery.get(g.ajax_url,t)]):(n()("#gform-settings-section-populate-anything-integration > .gform-settings-panel__content").children().remove(),n()("#gform-settings-section-populate-anything-integration > .gform-settings-panel__content").append('<div class="gpgs_token_health_error">\n\t\t\t\t<p>'.concat(g.gppa_section_no_global_token,"</p>\n\t\t\t</div>")),[2]);case 1:return e=o.sent(),n()("#gform-settings-section-populate-anything-integration").show(),e.success&&e.data.markup?(n()("#gform-settings-section-populate-anything-integration > .gform-settings-panel__content").children().remove(),n()("#gform-settings-section-populate-anything-integration > .gform-settings-panel__content").append(e.data.markup),window.gform_initialize_tooltips(),n()("#gp-google-sheets-add-spreadsheet").on("click.gpgsGppaSection",(function(t){t.preventDefault(),function(t){var e=t.token,n=t.showErrorMessage,o=t.onDataFound,r=t.strings,i={oauth_random_string:r.oauth_random_string,oauth_validation_token:r.oauth_validation_token,user_id:r.user_id};c({oAuthServiceUrl:"".concat(r.gwiz_oauth_service_url,"/google/file-picker"),inputs:[["postUrl","".concat(r.ajax_url,"?action=gpgs_picker_callback")],["accessToken",e.access_token],["state",JSON.stringify(i)]],id:"gpgs-google-sheet-picker"});var g="".concat(s,"_").concat(r.oauth_random_string);a({itemKey:g,handleItem:function(t){localStorage.removeItem(g);var e=JSON.parse(t);"0"!==e.success&&e.sheet_url?o(e):n(e.message||r.error_picking_spreadsheet)}})}({token:g.token,showErrorMessage:u,onDataFound:function(){window.location.reload()},strings:g})})),[2]):(n()("#gform-settings-section-populate-anything-integration > .gform-settings-panel__content").children().remove(),n()("#gform-settings-section-populate-anything-integration > .gform-settings-panel__content").append('<div class="gpgs_token_health_error">\n\t\t\t\t<p>'.concat(g.gppa_section_error_fetching,"</p>\n\t\t\t</div>")),[2])}}))}))}function b(){return r(this,void 0,void 0,(function(){var t,e,s;return i(this,(function(r){switch(r.label){case 0:return t={action:"gpgs_token_health",_ajax_nonce:g.nonce},[4,jQuery.get(g.ajax_url,t)];case 1:return(e=r.sent()).success?0===e.data.token_data.length?(n()("#gform_setting_token_health_placeholder").children().remove(),n()("#gform_setting_token_health_placeholder").append('<div class="gpgs_token_health_error">\n\t\t\t\t<p>'.concat(g.no_connected_tokens,"</p>\n\t\t\t</div>")),[2]):(e.data.token_data.sort((function(t,e){return null===t.userDisplayName?1:null===e.userDisplayName?-1:0})),window.gpgsToggleTokenFeeds=function(t){var e=n()(t),o=e.closest("tr");return o.toggleClass("gpgs-token-feeds-visible"),o.hasClass("gpgs-token-feeds-visible")?e.text("Hide Feeds"):e.text("Show Feeds"),!1},s='\n\t\t<table class="gform-table gform-table--responsive gform-table--no-outer-border gform-table--license-ui">\n\t\t\t<thead>\n\t\t\t\t<tr>\n\t\t\t\t  <th scope="user_display_name">User</th>\n\t\t\t\t  <th scope="email">Google Account Email</th>\n\t\t\t\t  <th scope="connected_feeds">Connected Feeds</th>\n\t\t\t\t  <th scope="is_healthy" class="gpgs_token_health_status">Status</th>\n\t\t\t\t  <th scope="reconnect"></th>\n\t\t\t\t</tr>\n\t  \t\t</thead>\n\t\t\t<tbody>\n\t\t\t\t'.concat(e.data.token_data.map((function(t){var e=t.tokenIsHealthy,n=t.googleEmail,o=t.connectedFeeds,s=t.userDisplayName,a=t.userEditLink,c=t.belongsToCurrentUser,r=t.legacyToken,i=f,_="",l="";r&&(_="".concat(v," ").concat(g.legacy_token)),e||(i=m,c&&(_='<button id="gpgs_reconnect_token" class="button button-secondary" onclick="return false;">Reconnect</button>',l="gpgs_unhealthy_token_reconnect_row"));var u='<td scope="row" class="gpgs_token_health_user_display_name"><a href="'.concat(a,'">').concat(s,"</a></td>");return null===s&&(u='<td scope="row" class="gpgs_token_health_user_display_name">–</td>'),"\n\t\t\t\t\t\t\t<tr class=".concat(l,">\n\t\t\t\t\t\t\t\t").concat(u,'\n    \t\t\t\t\t\t\t<td scope="row" class="gpgs_token_health_google_email">').concat(n||"",'</td>\n    \t\t\t\t\t\t\t<td scope="row" class="gpgs_token_health_connected_feeds">\n\t\t\t\t\t\t\t\t\t').concat((null==o?void 0:o.length)?'<a class="gpgs_token_toggle_feeds" onClick="gpgsToggleTokenFeeds(this);event.preventDefault();" href="#">Show Feeds</a> ('.concat(o.length,")"):"",'\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td scope="row" class="gpgs_token_health_status">').concat(i,'</td>\n\t\t\t\t\t\t\t\t<td scope="row" class="gpgs_token_health_reconnect_button">').concat(_,'</td>\n    \t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr class="gpgs-token-feeds gpgs_border_top">\n\t\t\t\t\t\t\t\t<td colspan="5" class="gpgs_light_grey_background">\n\t\t\t\t\t\t\t\t\t<table class="gform-table gform-table--responsive gform-table--no-outer-border gform-table--license-ui gpgs_light_grey_background gpgs_token_connected_feed_table">\n\t\t\t\t\t\t\t\t\t\t<thead class="gpgs_border_bottom">\n\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t\t<th>Form</th>\n\t\t\t\t\t\t\t\t\t\t\t\t<th>Feed</th>\n\t\t\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t\t</thead>\n\t\t\t\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t\t\t\t\t').concat(o.filter((function(t){var e=t.form_title,n=t.feed_name;return e&&n})).map((function(t){var e=t.form_title,n=t.feed_name,o=t.feed_url,s=t.form_id;return'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<tr class="gpgs_token_connected_feed_list_row">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td><a href="'.concat(g.admin_url,"?page=gf_edit_forms&id=").concat(s,'" target="_blank" rel=”noopener” rel=”noreferrer”>').concat(e,'</a></td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td><a href="').concat(o,'" target="_blank" rel=”noopener” rel=”noreferrer”>').concat(n,"</a></td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t")})).join(""),"\n\t\t\t\t\t\t\t\t\t</tbody>\n\t\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t")})).join(""),"\n  \t\t\t</tbody>\n\t\t</table>\n\t"),n()("#gform_setting_token_health_placeholder").children().remove(),n()("#gform_setting_token_health_placeholder").append(s),n()("#gpgs_reconnect_token").off("click.gpgsReconnectButton"),n()("#gpgs_reconnect_token").on("click.gpgsReconnectButton",(function(){var t={oauth_random_string:"".concat(g.oauth_random_string,"_").concat(g.user_id),oauth_validation_token:g.oauth_validation_token,user_id:g.user_id};c({oAuthServiceUrl:"".concat(g.gwiz_oauth_service_url,"/oauth/google"),inputs:[["redirectUrl","".concat(g.ajax_url,"?action=gpgs_plugin_settings_reconnect_oauth_callback")],["licenseId",g.gravity_perks_license_id],["licenseHash",g.gravity_perks_license_hash],["perkId",g.slug],["siteUrl",g.site_url],["state",JSON.stringify(t)]]});var e="".concat(o,"_").concat(g.oauth_random_string,"_").concat(g.user_id);a({itemKey:e,handleItem:function(t){localStorage.removeItem(e);var o=JSON.parse(t);if("0"!==o.success){var s=n()(".gpgs_unhealthy_token_reconnect_row");s.find(".gpgs_token_health_status").text(f),s.find(".gpgs_token_health_reconnect_button").children().remove(),"Successfully reconnected to Google Sheets!",n()("#gf-admin-notices-wrapper").append('<div class="notice notice-success gf-notice"><p><strong>'.concat("Successfully reconnected to Google Sheets!","</strong></p></div>"))}else u(o.message)}})})),[2]):(n()("#gform_setting_token_health_placeholder").children().remove(),n()("#gform_setting_token_health_placeholder").append('<div class="gpgs_token_health_error">\n\t\t\t\t<p>'.concat(g.token_health_error_fetching,"</p>\n\t\t\t</div>")),[2])}}))}))}n()(document).ready((function(){g.token?l():(_(),g.gravity_perks_license_id||(n()("#plugin_connect").prop("disabled",!0),n()("#plugin_connect").after('<p style="align-self: center;margin: 0 0 0 1rem;">'.concat(g.connecting_requires_valid_license,"</p>")),n()("#gpgs_connect_to_google_button").css("display","flex"))),function(){var t=new URL(window.location.href),e=new URLSearchParams(t.search),o=e.get("gwiz_oauth_message");if(o){var s=["alert"];e.get("gwiz_oauth_success")?s.push("gforms_note_success"):s.push("gforms_note_error"),n()(".gform-settings__content").prepend('<div class="'.concat(s.join(" "),'" role="alert">').concat(g.failed_to_connect_with_error_message.replace("%1$s",g.plugin_title).replace("%2$s",o),"</div>"))}}(),b(),k()}))})();
//# sourceMappingURL=gp-google-sheets-settings-global.js.map