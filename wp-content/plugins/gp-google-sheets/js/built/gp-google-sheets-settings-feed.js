(()=>{"use strict";var __webpack_modules__={52:(e,_,t)=>{t.d(_,{N:()=>s,r:()=>n});var s="gpgs_google_oauth_data",n="gpgs_google_picker_data"},370:(e,_,t)=>{t.d(_,{D2:()=>a,Vb:()=>o,bO:()=>i});var s=t(567),n=t.n(s),r=t(52);function a(e){var _=e.ms,t=void 0===_?1e3:_,s=e.itemKey,n=e.handleItem,r=setInterval((function(){var e=localStorage.getItem(s);e&&(clearInterval(r),n(e))}),t)}function o(e){var _=e.oAuthServiceUrl,t=e.inputs,s=e.id,r=void 0===s?"gpgs_oauth_form":s;n()('<form\n\t\t\tid="'.concat(r,'"\n\t\t\taction="').concat(_,'"\n\t\t\tmethod="POST"\n\t\t\ttarget="tab"\n\t\t>\n\t\t\t').concat(t.map((function(e){var _=e[0],t=e[1].replace(/"/g,"&quot;");return'<input type="hidden" name="'.concat(_,'" value="').concat(t,'">')})),"\n\t\t</form>")).appendTo("body").submit()}function i(e){var _=e.token,t=e.showErrorMessage,s=e.onDataFound,n=e.strings,i={oauth_random_string:n.oauth_random_string,oauth_validation_token:n.oauth_validation_token,user_id:n.user_id};o({oAuthServiceUrl:"".concat(n.gwiz_oauth_service_url,"/google/file-picker"),inputs:[["postUrl","".concat(n.ajax_url,"?action=gpgs_picker_callback")],["accessToken",_.access_token],["state",JSON.stringify(i)]],id:"gpgs-google-sheet-picker"});var c="".concat(r.r,"_").concat(n.oauth_random_string);a({itemKey:c,handleItem:function(e){localStorage.removeItem(c);var _=JSON.parse(e);"0"!==_.success&&_.sheet_url?s(_):t(_.message||n.error_picking_spreadsheet)}})}},662:(e,_,t)=>{t.d(_,{fh:()=>o,p0:()=>i,ro:()=>a,y2:()=>r});var s=t(567),n=t.n(s);function r(e){var _=e.nonce,t=e.formId,s=e.feedId,r=e.ajaxUrl;n()("#insert_test_row").off("click.gpgsInsertTestRowHandler"),n()("#insert_test_row").on("click.gpgsInsertTestRowHandler",(function(e){var a=n()(this);if(!a.data("isInserting")){a.data("isInserting",!0),n()(".spinner.spinner_insert_test_row").addClass("is-active");var o={action:"gpgs_insert_test_row",_ajax_nonce:_,form_id:t,feed_id:s};jQuery.post(r,o,(function(e){a.data("isInserting",!1),n()(".gform-settings__content").prepend(e.data.message),n()(".spinner.spinner_insert_test_row").removeClass("is-active")}))}}))}function a(e){var _=e.nonce,t=e.formId,s=e.feedId,r=e.ajaxUrl;n()("#feed_disconnect,#disconnect").off("click.gpgsDisconnectSheetHandler"),n()("#feed_disconnect,#disconnect").on("click.gpgsDisconnectSheetHandler",(function(){n()(".spinner.spinner_disconnect").addClass("is-active");var e={action:"gpgs_disconnect",_ajax_nonce:_,form_id:t,feed_id:s};jQuery.post(r,e,(function(e){e.success&&location.reload(),n()(".spinner.spinner_disconnect").removeClass("is-active")}))}))}function o(){var e;e="#gform-settings-section-column-mapping",n()(e).addClass("gpgs-disabled-settings-section").attr("inert","true")}function i(){var e;e="#gform-settings-section-column-mapping",n()(e).removeClass("gpgs-disabled-settings-section").removeAttr("inert")}},567:e=>{e.exports=window.jQuery},694:e=>{e.exports=window.wp.hooks}},__webpack_module_cache__={};function __webpack_require__(e){var _=__webpack_module_cache__[e];if(void 0!==_)return _.exports;var t=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](t,t.exports,__webpack_require__),t.exports}__webpack_require__.n=e=>{var _=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(_,{a:_}),_},__webpack_require__.d=(e,_)=>{for(var t in _)__webpack_require__.o(_,t)&&!__webpack_require__.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:_[t]})},__webpack_require__.o=(e,_)=>Object.prototype.hasOwnProperty.call(e,_);var __webpack_exports__={};(()=>{var jquery__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(567),jquery__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__),_wordpress_hooks__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(694),_wordpress_hooks__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_wordpress_hooks__WEBPACK_IMPORTED_MODULE_1__),_helpers__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(370),_settings_feed_shared__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(662),_constants__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(52),strings=window.gpgs_settings_strings;function hideSheetSelect(){jquery__WEBPACK_IMPORTED_MODULE_0___default()("#gform_setting_google_sheet_id_selector").hide()}function showSheetSelect(){jquery__WEBPACK_IMPORTED_MODULE_0___default()("#gform_setting_google_sheet_id_selector").show()}function openOAuthTab(){var e="".concat(strings.gwiz_oauth_service_url,"/oauth/google"),_={oauth_random_string:strings.oauth_random_string,oauth_validation_token:strings.oauth_validation_token,user_id:strings.user_id};(0,_helpers__WEBPACK_IMPORTED_MODULE_2__.Vb)({oAuthServiceUrl:e,inputs:[["licenseId",strings.gravity_perks_license_id],["licenseHash",strings.gravity_perks_license_hash],["redirectUrl","".concat(strings.ajax_url,"?action=gpgs_feed_settings_oauth_callback")],["perkId",strings.slug],["siteUrl",strings.site_url],["state",JSON.stringify(_)]]});var t="".concat(_constants__WEBPACK_IMPORTED_MODULE_4__.N,"_").concat(strings.oauth_random_string);(0,_helpers__WEBPACK_IMPORTED_MODULE_2__.D2)({itemKey:t,handleItem:function(e){localStorage.removeItem(t);var _=JSON.parse(e);"0"!==_.success&&_.token?(setGoogleAuthToken(_.token),(0,_helpers__WEBPACK_IMPORTED_MODULE_2__.bO)({token:_.token,showErrorMessage:addErrorMessage,onDataFound:function(e){var _=e.sheet_url;_&&handleGoogleSpreadsheetURLUpdate(_),hideOAuthSpinner()},strings})):addErrorMessage(_.message)}})}function addErrorMessage(e){jquery__WEBPACK_IMPORTED_MODULE_0___default()("#gf-admin-notices-wrapper").append('<div class="notice notice-error gf-notice"><p><strong>'.concat(strings.error_authenticating_with_google," ").concat(e,"</strong></p></div>"))}function replaceSpreadsheetLinkMarkup(e){jquery__WEBPACK_IMPORTED_MODULE_0___default()("#gform_setting_google_sheet_url_field span.gform-settings-input__container").remove(),jquery__WEBPACK_IMPORTED_MODULE_0___default()("#gform_setting_google_sheet_url_field > p").remove(),jquery__WEBPACK_IMPORTED_MODULE_0___default()("#gform_setting_google_sheet_url_field").append(e)}function handleGoogleSpreadsheetURLUpdate(e){var _=e.split("?")[0];document.getElementById("google_sheet_url").value=_,document.getElementById("sheet_was_picked").value="1";var t={action:"gpgs_select_spreadsheet",_ajax_nonce:strings.nonce,id:strings.form_id,feed_id:strings.feed_id,sheet_url:_,sheet_was_picked:"1"};jQuery.get(strings.ajax_url,t,(function(e){if(e.success){replaceSpreadsheetLinkMarkup(e.data.spreadsheetLinkMarkup);var _=e.data,t=_.sheets,s=_.spreadsheetName;strings.spreadsheetName=s;for(var n=0,r=t;n<r.length;n++){var a=r[n];jquery__WEBPACK_IMPORTED_MODULE_0___default()("#google_sheet_id_selector").append('<option label="'.concat(a.title,'" value="').concat(a.id,'" id="gpgs_selected_sheet_').concat(a.id,'"></option>'))}showSheetSelect(),addSheetSelectorEventHandler(),1===t.length&&(jquery__WEBPACK_IMPORTED_MODULE_0___default()("#gpgs_selected_sheet_".concat(t[0].id)).attr("selected","selected"),jquery__WEBPACK_IMPORTED_MODULE_0___default()("#google_sheet_id_selector").trigger("change"))}}))}function addSheetSelectorEventHandler(){jquery__WEBPACK_IMPORTED_MODULE_0___default()("#google_sheet_id_selector").off("change.gpgsSheetSelected"),jquery__WEBPACK_IMPORTED_MODULE_0___default()("#google_sheet_id_selector").on("change.gpgsSheetSelected",(function(event){(0,_settings_feed_shared__WEBPACK_IMPORTED_MODULE_3__.fh)();var sheetId=jquery__WEBPACK_IMPORTED_MODULE_0___default()(event.target).val();if(sheetId){var options=jquery__WEBPACK_IMPORTED_MODULE_0___default()(event.target).find("option"),sheetName="";options.each((function(e,_){_.value===sheetId&&(sheetName=_.label)})),document.getElementById("google_sheet_id").value=sheetId;var postData={action:"gpgs_select_sheet",_ajax_nonce:strings.nonce,id:strings.form_id,feed_id:strings.feed_id,sheet_url:jquery__WEBPACK_IMPORTED_MODULE_0___default()("#google_sheet_url").val(),spreadsheet_name:strings.spreadsheetName,sheet_id:sheetId,sheet_name:sheetName,sheet_was_picked:"1"};jQuery.get(strings.ajax_url,postData,(function(response){var matches=response.data.controlsHTML.match(/<script type=\"text\/javascript\">(.+)<\/script>/);if(replaceSpreadsheetLinkMarkup(response.data.spreadsheetLinkMarkup),null==matches?void 0:matches.length){var controlsHTML=response.data.controlsHTML.replace(matches[0],"");jquery__WEBPACK_IMPORTED_MODULE_0___default()("#gform_setting_column_mapping").html(controlsHTML),(0,_settings_feed_shared__WEBPACK_IMPORTED_MODULE_3__.p0)();try{eval(matches[1])}catch(e){console.warn(e)}}}))}}))}function addRadioChangeHandlerSelect(){jquery__WEBPACK_IMPORTED_MODULE_0___default()("#google_sheet_url_field0").on("change",(function(){"create"===jquery__WEBPACK_IMPORTED_MODULE_0___default()("input[name='_gform_setting_google_sheet_url_field']:checked").val()&&(0,_settings_feed_shared__WEBPACK_IMPORTED_MODULE_3__.p0)()})),jquery__WEBPACK_IMPORTED_MODULE_0___default()("#google_sheet_url_field1").on("change",(function(){"select"===jquery__WEBPACK_IMPORTED_MODULE_0___default()("input[name='_gform_setting_google_sheet_url_field']:checked").val()&&(showOAuthSpinner(),(0,_settings_feed_shared__WEBPACK_IMPORTED_MODULE_3__.fh)(),strings.token?(0,_helpers__WEBPACK_IMPORTED_MODULE_2__.bO)({token:strings.token,showErrorMessage:addErrorMessage,onDataFound:function(e){var _=e.sheet_url;_&&handleGoogleSpreadsheetURLUpdate(_),hideOAuthSpinner()},strings}):openOAuthTab())}))}function setGoogleAuthToken(e){strings.token=e}jquery__WEBPACK_IMPORTED_MODULE_0___default()((function(){strings.token&&setGoogleAuthToken(strings.token),(0,_settings_feed_shared__WEBPACK_IMPORTED_MODULE_3__.y2)({nonce:strings.nonce,formId:strings.form_id,feedId:strings.feed_id,ajaxUrl:strings.ajax_url}),(0,_settings_feed_shared__WEBPACK_IMPORTED_MODULE_3__.ro)({nonce:strings.nonce,formId:strings.form_id,feedId:strings.feed_id,ajaxUrl:strings.ajax_url}),addRadioChangeHandlerSelect(),hideSheetSelect(),addOAuthSpinner(),jquery__WEBPACK_IMPORTED_MODULE_0___default()("#gform_setting_google_sheet_url_field").find(".gforms_note_success").length?(0,_settings_feed_shared__WEBPACK_IMPORTED_MODULE_3__.p0)():(0,_settings_feed_shared__WEBPACK_IMPORTED_MODULE_3__.fh)()})),(0,_wordpress_hooks__WEBPACK_IMPORTED_MODULE_1__.addFilter)("i18n.gettext","gp-google-sheets/override-generic-map-column-labels",(function(e,_,t){return"Select a Field"===_?strings.select_a_column:"Add Custom Key"===_?strings.add_new_column:e}));var SPINNER_ID="gpgs_oauth_spinner";function addOAuthSpinner(){jquery__WEBPACK_IMPORTED_MODULE_0___default()("#".concat(SPINNER_ID)).remove(),jquery__WEBPACK_IMPORTED_MODULE_0___default()("#gform-settings-radio-choice-google_sheet_url_field1").append('<span id="'.concat(SPINNER_ID,'" class="spinner spinner_connect"></span>'))}function showOAuthSpinner(){jquery__WEBPACK_IMPORTED_MODULE_0___default()("#".concat(SPINNER_ID)).addClass("is-active")}function hideOAuthSpinner(){jquery__WEBPACK_IMPORTED_MODULE_0___default()("#".concat(SPINNER_ID)).removeClass("is-active")}})()})();
//# sourceMappingURL=gp-google-sheets-settings-feed.js.map