{"version":3,"file":"gp-google-sheets-settings-feed.js","mappings":"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","sources":["webpack:///./js/src/constants.ts","webpack:///./js/src/helpers.ts","webpack:///./js/src/settings-feed-shared.ts","webpack:///external window \"jQuery\"","webpack:///external window [\"wp\",\"hooks\"]","webpack:///webpack/bootstrap","webpack:///webpack/runtime/compat get default export","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///./js/src/settings-feed.ts"],"sourcesContent":["export const GOOGLE_TOKEN_KEY = 'gpgs_google_oauth_data';\nexport const GOOGLE_PICKER_DATA_KEY = 'gpgs_google_picker_data';\n","import $ from 'jquery';\n// eslint-disable-next-line import/no-unresolved\nimport { Token } from './typings/global';\nimport { GOOGLE_PICKER_DATA_KEY } from './constants';\n// eslint-disable-next-line prettier/prettier\nimport type {\n\tOAuthResponseData,\n\tGPGSPluginSettingsStrings,\n\tGPGSFeedSettingsStrings,\n} from './typings/global';\n\n/**\n * Polls local storage for a specific item.\n *\n * @param {Object}   params\n * @param {number}   params.ms         The number of milliseconds to wait between polls.\n * @param {string}   params.itemKey    The key of the item to poll for.\n * @param {Function} params.handleItem The function to call when the item is found.\n */\nexport function pollLocalStorage({\n\tms = 1000,\n\titemKey,\n\thandleItem,\n}: {\n\tms?: number;\n\titemKey: string;\n\thandleItem: (item: string) => void;\n}) {\n\tconst interval = setInterval(() => {\n\t\tconst item = localStorage.getItem(itemKey);\n\n\t\tif (item) {\n\t\t\tclearInterval(interval);\n\t\t\thandleItem(item);\n\t\t}\n\t}, ms);\n}\n\n/**\n * Helper to create a form with given inputs on the fly and post it in a new tab.\n */\nexport function submitOAuthForm({\n\toAuthServiceUrl,\n\tinputs,\n\tid = 'gpgs_oauth_form',\n}: {\n\toAuthServiceUrl: string;\n\tinputs: [string, string][];\n\tid?: string;\n}) {\n\t$(\n\t\t`<form\n\t\t\tid=\"${id}\"\n\t\t\taction=\"${oAuthServiceUrl}\"\n\t\t\tmethod=\"POST\"\n\t\t\ttarget=\"tab\"\n\t\t>\n\t\t\t${inputs.map(([name, value]) => {\n\t\t\t\tconst escapedValue = value.replace(/\"/g, '&quot;');\n\t\t\t\treturn `<input type=\"hidden\" name=\"${name}\" value=\"${escapedValue}\">`;\n\t\t\t})}\n\t\t</form>`\n\t)\n\t\t.appendTo('body')\n\t\t.submit();\n}\n\n/**\n * Helper to load the Google Picker.\n *\n * @param opts\n * @param opts.token\n * @param opts.showErrorMessage\n * @param opts.onDataFound\n * @param opts.strings\n */\nexport function showPicker({\n\ttoken,\n\tshowErrorMessage,\n\tonDataFound,\n\tstrings,\n}: {\n\ttoken: Token;\n\tshowErrorMessage: (message: string) => void;\n\tonDataFound: (data: OAuthResponseData) => void;\n\tstrings: GPGSPluginSettingsStrings | GPGSFeedSettingsStrings;\n}) {\n\tconst state = {\n\t\toauth_random_string: strings.oauth_random_string,\n\t\toauth_validation_token: strings.oauth_validation_token,\n\t\tuser_id: strings.user_id,\n\t};\n\n\tsubmitOAuthForm({\n\t\toAuthServiceUrl: `${strings.gwiz_oauth_service_url}/google/file-picker`,\n\t\tinputs: [\n\t\t\t['postUrl', `${strings.ajax_url}?action=gpgs_picker_callback`],\n\t\t\t['accessToken', token.access_token],\n\t\t\t['state', JSON.stringify(state)],\n\t\t],\n\t\tid: 'gpgs-google-sheet-picker',\n\t});\n\n\tconst pickerDataLocalStorageKey = `${GOOGLE_PICKER_DATA_KEY}_${strings.oauth_random_string}`;\n\t/**\n\t * Start checking local storage for the Google Sheet URL.\n\t * This way we know when the user has picked a sheet in the opened picker\n\t * tab.\n\t */\n\tpollLocalStorage({\n\t\titemKey: pickerDataLocalStorageKey,\n\t\thandleItem: (item) => {\n\t\t\tlocalStorage.removeItem(pickerDataLocalStorageKey);\n\n\t\t\tconst data: OAuthResponseData = JSON.parse(item);\n\n\t\t\tif (data.success === '0' || !data.sheet_url) {\n\t\t\t\tshowErrorMessage(\n\t\t\t\t\tdata.message || strings.error_picking_spreadsheet\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tonDataFound(data);\n\t\t},\n\t});\n}\n","/**\n * Shared functions for use within the feed settings context.\n */\nimport $ from 'jquery';\n\ninterface ClickHandlerArgs {\n\tnonce: string;\n\tformId: string;\n\tfeedId: string;\n\tajaxUrl: string;\n}\n\n/**\n * Adds \"insert test row\" event handler\n */\nexport function addButtonClickHandlerInsert({\n\tnonce,\n\tformId,\n\tfeedId,\n\tajaxUrl,\n}: ClickHandlerArgs) {\n\t$('#insert_test_row').off('click.gpgsInsertTestRowHandler');\n\n\t$('#insert_test_row').on('click.gpgsInsertTestRowHandler', function (eee) {\n\t\tconst $button = $(this);\n\t\tif ($button.data('isInserting')) {\n\t\t\treturn;\n\t\t}\n\n\t\t$button.data('isInserting', true);\n\t\t// show spinner\n\t\t$('.spinner.spinner_insert_test_row').addClass('is-active');\n\t\tconst data = {\n\t\t\taction: 'gpgs_insert_test_row',\n\t\t\t_ajax_nonce: nonce,\n\t\t\tform_id: formId,\n\t\t\tfeed_id: feedId,\n\t\t};\n\t\tjQuery.post(ajaxUrl, data, function (response) {\n\t\t\t$button.data('isInserting', false);\n\t\t\t$('.gform-settings__content').prepend(response.data.message);\n\t\t\t// hide spinner\n\t\t\t$('.spinner.spinner_insert_test_row').removeClass('is-active');\n\t\t});\n\t});\n}\n\n/**\n * Adds \"disconnected sheet\" event handler\n */\nexport function addButtonClickHandlerDisconnect({\n\tnonce,\n\tformId,\n\tfeedId,\n\tajaxUrl,\n}: ClickHandlerArgs) {\n\t$('#feed_disconnect,#disconnect').off('click.gpgsDisconnectSheetHandler');\n\n\t$('#feed_disconnect,#disconnect').on(\n\t\t'click.gpgsDisconnectSheetHandler',\n\t\tfunction () {\n\t\t\t// show spinner\n\t\t\t$('.spinner.spinner_disconnect').addClass('is-active');\n\t\t\tconst data = {\n\t\t\t\taction: 'gpgs_disconnect',\n\t\t\t\t_ajax_nonce: nonce,\n\t\t\t\tform_id: formId,\n\t\t\t\tfeed_id: feedId,\n\t\t\t};\n\t\t\tjQuery.post(ajaxUrl, data, function (response) {\n\t\t\t\tif (response.success) {\n\t\t\t\t\t// Refresh the page so the user can connect a new sheet.\n\t\t\t\t\tlocation.reload();\n\t\t\t\t}\n\n\t\t\t\t// hide spinner\n\t\t\t\t$('.spinner.spinner_disconnect').removeClass('is-active');\n\t\t\t});\n\t\t}\n\t);\n}\n\nfunction disableSettingsSection(selector: string) {\n\t$(selector)\n\t\t.addClass('gpgs-disabled-settings-section')\n\t\t.attr('inert', 'true');\n}\n\nfunction enableSettingsSection(selector: string) {\n\t$(selector)\n\t\t.removeClass('gpgs-disabled-settings-section')\n\t\t.removeAttr('inert');\n}\n\nexport function disableSheetSettingsSection() {\n\tdisableSettingsSection('#gform-settings-section-google-sheets-settings');\n}\n\nexport function enableSheetSettingsSection() {\n\tenableSettingsSection('#gform-settings-section-google-sheets-settings');\n}\n\nexport function disableColumnMappingSection() {\n\tdisableSettingsSection('#gform-settings-section-column-mapping');\n}\n\nexport function enableColumnMappingSection() {\n\tenableSettingsSection('#gform-settings-section-column-mapping');\n}\n","module.exports = window[\"jQuery\"];","module.exports = window[\"wp\"][\"hooks\"];","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","import $ from 'jquery';\nimport { addFilter } from '@wordpress/hooks';\n// eslint-disable-next-line prettier/prettier\nimport type { Token, OAuthResponseData } from './typings/global';\nimport { pollLocalStorage, showPicker, submitOAuthForm } from './helpers';\nimport {\n\taddButtonClickHandlerInsert,\n\taddButtonClickHandlerDisconnect,\n\tdisableColumnMappingSection,\n\tenableColumnMappingSection,\n} from './settings-feed-shared';\nimport { GOOGLE_TOKEN_KEY } from './constants';\n\ninterface SpreadSheetSelectedResponse {\n\tsuccess: boolean;\n\tdata: {\n\t\tspreadsheetLinkMarkup: string;\n\t\tspreadsheetName: string;\n\t\tsheets: Array<{ title: string; id: string }>;\n\t};\n}\ninterface SheetSelectedResponse {\n\tsuccess: boolean;\n\tdata: {\n\t\tcontrolsHTML: string;\n\t\tspreadsheetLinkMarkup: string;\n\t};\n}\n\nconst { gpgs_settings_strings: strings } = window;\n\n/**\n * Register handlers for all buttons, radio inputs, etc.\n */\n$(function () {\n\t// TODO do not do this lol.\n\tif (strings.token) {\n\t\tsetGoogleAuthToken(strings.token);\n\t}\n\n\taddButtonClickHandlerInsert({\n\t\tnonce: strings.nonce,\n\t\tformId: strings.form_id,\n\t\tfeedId: strings.feed_id,\n\t\tajaxUrl: strings.ajax_url,\n\t});\n\n\taddButtonClickHandlerDisconnect({\n\t\tnonce: strings.nonce,\n\t\tformId: strings.form_id,\n\t\tfeedId: strings.feed_id,\n\t\tajaxUrl: strings.ajax_url,\n\t});\n\n\taddRadioChangeHandlerSelect();\n\n\thideSheetSelect();\n\n\taddOAuthSpinner();\n\n\tif (\n\t\t$('#gform_setting_google_sheet_url_field').find('.gforms_note_success')\n\t\t\t.length\n\t) {\n\t\t//  If the page is ready and a Google Sheet link was successfully loaded, enable editing of column mapping.\n\t\tenableColumnMappingSection();\n\t} else {\n\t\t//Otherwise, we are creating a new feed and this should be disabled until the user selects a sheet.\n\t\tdisableColumnMappingSection();\n\t}\n});\n\naddFilter(\n\t'i18n.gettext',\n\t'gp-google-sheets/override-generic-map-column-labels',\n\t(translation: string, text: string, domain: string) => {\n\t\tif (text === 'Select a Field') {\n\t\t\treturn strings.select_a_column;\n\t\t}\n\n\t\tif (text === 'Add Custom Key') {\n\t\t\treturn strings.add_new_column;\n\t\t}\n\n\t\treturn translation;\n\t}\n);\n\n/**\n * Hides the sheet select component\n */\nfunction hideSheetSelect() {\n\t$('#gform_setting_google_sheet_id_selector').hide();\n}\n\n/**\n * Shows the sheet select component\n */\nfunction showSheetSelect() {\n\t$('#gform_setting_google_sheet_id_selector').show();\n}\n\nfunction openOAuthTab() {\n\tconst url = `${strings.gwiz_oauth_service_url}/oauth/google`;\n\n\tconst state = {\n\t\toauth_random_string: strings.oauth_random_string,\n\t\toauth_validation_token: strings.oauth_validation_token,\n\t\tuser_id: strings.user_id,\n\t};\n\n\tsubmitOAuthForm({\n\t\toAuthServiceUrl: url,\n\t\tinputs: [\n\t\t\t['licenseId', strings.gravity_perks_license_id],\n\t\t\t['licenseHash', strings.gravity_perks_license_hash],\n\t\t\t[\n\t\t\t\t'redirectUrl',\n\t\t\t\t`${strings.ajax_url}?action=gpgs_feed_settings_oauth_callback`,\n\t\t\t],\n\t\t\t['perkId', strings.slug],\n\t\t\t['siteUrl', strings.site_url],\n\t\t\t['state', JSON.stringify(state)],\n\t\t],\n\t});\n\n\tconst oauthDataLocalStorageKey = `${GOOGLE_TOKEN_KEY}_${strings.oauth_random_string}`;\n\n\t/**\n\t * Start checking local storage for the Google Token.\n\t * This way we know when the user has finished oauthing so that we can\n\t * store the token so that it will be saved when the feed is created.\n\t */\n\tpollLocalStorage({\n\t\titemKey: oauthDataLocalStorageKey,\n\t\thandleItem: (item) => {\n\t\t\t// remove the item from local storage to prevent it from interfering with future polling.\n\t\t\tlocalStorage.removeItem(oauthDataLocalStorageKey);\n\n\t\t\tconst data: OAuthResponseData = JSON.parse(item);\n\n\t\t\tif (data.success === '0' || !data.token) {\n\t\t\t\taddErrorMessage(data.message);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tsetGoogleAuthToken(data.token);\n\n\t\t\tshowPicker({\n\t\t\t\ttoken: data.token,\n\t\t\t\tshowErrorMessage: addErrorMessage,\n\t\t\t\tonDataFound: ({ sheet_url: sheetUrl }) => {\n\t\t\t\t\tif (sheetUrl) {\n\t\t\t\t\t\thandleGoogleSpreadsheetURLUpdate(sheetUrl);\n\t\t\t\t\t}\n\n\t\t\t\t\thideOAuthSpinner();\n\t\t\t\t},\n\t\t\t\tstrings,\n\t\t\t});\n\t\t},\n\t});\n}\n\nfunction addErrorMessage(message: string) {\n\t$('#gf-admin-notices-wrapper').append(\n\t\t`<div class=\"notice notice-error gf-notice\"><p><strong>${strings.error_authenticating_with_google} ${message}</strong></p></div>`\n\t);\n}\n\nfunction replaceSpreadsheetLinkMarkup(html: string) {\n\t// Hide the select/create radio buttons\n\t$(\n\t\t'#gform_setting_google_sheet_url_field span.gform-settings-input__container'\n\t).remove();\n\n\t// Remove any existing links\n\t$('#gform_setting_google_sheet_url_field > p').remove();\n\n\t// Add the link to the spreadsheet\n\t$('#gform_setting_google_sheet_url_field').append(html);\n}\n\nfunction handleGoogleSpreadsheetURLUpdate(googleSheetUrl: string) {\n\tconst url = googleSheetUrl.split('?')[0];\n\n\t// Update the hidden field with the sheet URL\n\t(document.getElementById('google_sheet_url') as HTMLInputElement).value =\n\t\turl;\n\n\t(document.getElementById('sheet_was_picked') as HTMLInputElement).value =\n\t\t'1';\n\n\t// Get the columns out of the sheet, populate field map\n\tconst postData = {\n\t\taction: 'gpgs_select_spreadsheet',\n\t\t_ajax_nonce: strings.nonce,\n\t\tid: strings.form_id,\n\t\tfeed_id: strings.feed_id,\n\t\tsheet_url: url,\n\t\tsheet_was_picked: '1',\n\t};\n\n\tjQuery.get(\n\t\tstrings.ajax_url,\n\t\tpostData,\n\t\t(response: SpreadSheetSelectedResponse) => {\n\t\t\tif (!response.success) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treplaceSpreadsheetLinkMarkup(response.data.spreadsheetLinkMarkup);\n\n\t\t\t// Add the spreadsheet's sheets to the \"Sheet\" select\n\t\t\tconst { sheets, spreadsheetName } = response.data;\n\n\t\t\tstrings.spreadsheetName = spreadsheetName;\n\n\t\t\tfor (const sheet of sheets) {\n\t\t\t\t$('#google_sheet_id_selector').append(\n\t\t\t\t\t`<option label=\"${sheet.title}\" value=\"${sheet.id}\" id=\"gpgs_selected_sheet_${sheet.id}\"></option>`\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tshowSheetSelect();\n\t\t\taddSheetSelectorEventHandler();\n\n\t\t\t// Auto select the first sheet if there is only one\n\t\t\tif (sheets.length === 1) {\n\t\t\t\t$(`#gpgs_selected_sheet_${sheets[0].id}`).attr(\n\t\t\t\t\t'selected',\n\t\t\t\t\t'selected'\n\t\t\t\t);\n\n\t\t\t\t// trigger the change on the <select/> so that the event.target is correct.\n\t\t\t\t// if triggering directly on the <option/> the event.target is the <option/> and not the <select/>\n\t\t\t\t// due to event bubbling.\n\t\t\t\t$('#google_sheet_id_selector').trigger('change');\n\t\t\t}\n\t\t}\n\t);\n}\n\nfunction addSheetSelectorEventHandler() {\n\t// remove the event handler if already bound so that we don't end up with multiple listeners\n\t$('#google_sheet_id_selector').off('change.gpgsSheetSelected');\n\n\t// bind the new handler\n\t$('#google_sheet_id_selector').on('change.gpgsSheetSelected', (event) => {\n\t\tdisableColumnMappingSection();\n\n\t\tconst sheetId = $(event.target).val();\n\n\t\t// If no sheetId, then the default \"Select a Sheet\" option has been selected which does not have a any sheet associated with it.\n\t\tif (!sheetId) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst options = $(event.target).find('option');\n\t\tlet sheetName = '';\n\n\t\toptions.each((index, $option) => {\n\t\t\tif ($option.value === sheetId) {\n\t\t\t\tsheetName = $option.label;\n\t\t\t}\n\t\t});\n\n\t\t(document.getElementById('google_sheet_id') as HTMLInputElement).value =\n\t\t\tsheetId as string;\n\n\t\t// Get the columns out of the sheet, populate field map\n\t\tconst postData = {\n\t\t\taction: 'gpgs_select_sheet',\n\t\t\t_ajax_nonce: strings.nonce,\n\t\t\tid: strings.form_id,\n\t\t\tfeed_id: strings.feed_id,\n\t\t\tsheet_url: $('#google_sheet_url').val(),\n\t\t\tspreadsheet_name: strings.spreadsheetName,\n\t\t\tsheet_id: sheetId,\n\t\t\tsheet_name: sheetName,\n\t\t\tsheet_was_picked: '1',\n\t\t};\n\n\t\tjQuery.get(\n\t\t\tstrings.ajax_url,\n\t\t\tpostData,\n\t\t\t(response: SheetSelectedResponse) => {\n\t\t\t\t// Extract the <script block out of the controls\n\t\t\t\tconst matches = response.data.controlsHTML.match(\n\t\t\t\t\t/<script type=\\\"text\\/javascript\\\">(.+)<\\/script>/\n\t\t\t\t);\n\n\t\t\t\treplaceSpreadsheetLinkMarkup(\n\t\t\t\t\tresponse.data.spreadsheetLinkMarkup\n\t\t\t\t);\n\n\t\t\t\tif (matches?.length) {\n\t\t\t\t\t// Remove the script from the markup\n\t\t\t\t\tconst controlsHTML = response.data.controlsHTML.replace(\n\t\t\t\t\t\tmatches[0],\n\t\t\t\t\t\t''\n\t\t\t\t\t);\n\n\t\t\t\t\t$('#gform_setting_column_mapping').html(controlsHTML);\n\n\t\t\t\t\tenableColumnMappingSection();\n\n\t\t\t\t\t// Run the initialization script for the field map field\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// eslint-disable-next-line no-eval\n\t\t\t\t\t\teval(matches[1]);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\t\t\tconsole.warn(e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t});\n}\n\nfunction addRadioChangeHandlerSelect() {\n\t$('#google_sheet_url_field0').on('change', function () {\n\t\tif (\n\t\t\t$(\n\t\t\t\t\"input[name='_gform_setting_google_sheet_url_field']:checked\"\n\t\t\t).val() === 'create'\n\t\t) {\n\t\t\tenableColumnMappingSection();\n\t\t}\n\t});\n\t$('#google_sheet_url_field1').on('change', function () {\n\t\t// If the value is \"select\", then the \"Select existing sheet\" radio button was selected.\n\t\tconst selectRadioChecked =\n\t\t\t$(\n\t\t\t\t\"input[name='_gform_setting_google_sheet_url_field']:checked\"\n\t\t\t).val() === 'select';\n\n\t\tif (!selectRadioChecked) {\n\t\t\treturn;\n\t\t}\n\n\t\tshowOAuthSpinner();\n\n\t\tdisableColumnMappingSection();\n\n\t\tif (!strings.token) {\n\t\t\topenOAuthTab();\n\t\t} else {\n\t\t\tshowPicker({\n\t\t\t\ttoken: strings.token,\n\t\t\t\tshowErrorMessage: addErrorMessage,\n\t\t\t\tonDataFound: ({ sheet_url: sheetUrl }) => {\n\t\t\t\t\tif (sheetUrl) {\n\t\t\t\t\t\thandleGoogleSpreadsheetURLUpdate(sheetUrl);\n\t\t\t\t\t}\n\n\t\t\t\t\thideOAuthSpinner();\n\t\t\t\t},\n\t\t\t\tstrings,\n\t\t\t});\n\t\t}\n\t});\n}\n\nfunction setGoogleAuthToken(token: Token) {\n\tstrings.token = token;\n}\n\nconst SPINNER_ID = 'gpgs_oauth_spinner';\nfunction addOAuthSpinner() {\n\t$(`#${SPINNER_ID}`).remove();\n\n\t$('#gform-settings-radio-choice-google_sheet_url_field1').append(\n\t\t`<span id=\"${SPINNER_ID}\" class=\"spinner spinner_connect\"></span>`\n\t);\n}\n\nfunction showOAuthSpinner() {\n\t$(`#${SPINNER_ID}`).addClass('is-active');\n}\n\nfunction hideOAuthSpinner() {\n\t$(`#${SPINNER_ID}`).removeClass('is-active');\n}\n"],"names":["GOOGLE_TOKEN_KEY","GOOGLE_PICKER_DATA_KEY","pollLocalStorage","ms","itemKey","handleItem","interval","setInterval","item","localStorage","getItem","clearInterval","submitOAuthForm","oAuthServiceUrl","inputs","id","map","name","escapedValue","replace","appendTo","submit","showPicker","token","showErrorMessage","onDataFound","strings","state","oauth_random_string","oauth_validation_token","user_id","gwiz_oauth_service_url","ajax_url","access_token","JSON","stringify","pickerDataLocalStorageKey","removeItem","data","parse","success","sheet_url","message","error_picking_spreadsheet","addButtonClickHandlerInsert","nonce","formId","feedId","ajaxUrl","off","on","eee","$button","this","addClass","action","_ajax_nonce","form_id","feed_id","jQuery","post","response","prepend","removeClass","addButtonClickHandlerDisconnect","location","reload","disableColumnMappingSection","selector","attr","enableColumnMappingSection","removeAttr","module","exports","window","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","hideSheetSelect","hide","showSheetSelect","show","openOAuthTab","url","gravity_perks_license_id","gravity_perks_license_hash","slug","site_url","oauthDataLocalStorageKey","setGoogleAuthToken","addErrorMessage","sheetUrl","handleGoogleSpreadsheetURLUpdate","hideOAuthSpinner","append","error_authenticating_with_google","replaceSpreadsheetLinkMarkup","html","remove","googleSheetUrl","split","document","getElementById","value","postData","sheet_was_picked","spreadsheetLinkMarkup","sheets","spreadsheetName","sheet","title","addSheetSelectorEventHandler","length","trigger","event","sheetId","target","val","options","find","sheetName","each","index","$option","label","spreadsheet_name","sheet_id","sheet_name","matches","controlsHTML","match","eval","e","console","warn","addRadioChangeHandlerSelect","showOAuthSpinner","addOAuthSpinner","addFilter","translation","text","domain","select_a_column","add_new_column","SPINNER_ID"],"sourceRoot":""}