!function(s){var o,n=new Array,m=new Array;function e(e){e.preventDefault();var t=(o=s(this).closest(".crown-gallery-input")).data("basename");n[t]||(n[t]=wp.media.frames.crownGalleryCreateFrames[t]=wp.media({title:"Add to Gallery",button:{text:"Add to gallery"},library:{type:"image"},multiple:!0}),n[t].on("select",function(){for(var e=n[t].state().get("selection"),a=[],l=0;l<e.models.length;l++){var r=e.models[l].attributes;a.push(r.id)}i(0,a)})),n[t].open()}function a(e){e.preventDefault(),o=s(this).closest(".crown-gallery-input");var l=[];s("ul.gallery-images > li input[type=hidden]",o).each(function(e,a){l.push(s(a).val())}),i(0,l)}function i(e,a,l,r,t){l=void 0!==l?l:6,r=void 0!==r?r:"file",t=void 0!==t?t:"menu_order ID";var n=o.data("basename"),i=['ids="'+a.join(",")+'"','columns="'+l+'"','link="'+r+'"','orderby="'+t+'"'];m[n]=wp.media.frames.crownGalleryFrames[n]=wp.media.gallery.edit("[gallery "+i.join(" ")+"]"),s(m[n].el).addClass("hidden-gallery-settings"),m[n].on("update",function(e){!function(e,a,l){console.log(l),s("ul.gallery-images li",e).remove(),e.removeClass("has-media");for(var r=0;r<a.length;r++){var t=a[r].attributes,n=t.icon;"image"==t.type&&(n=t.sizes.thumbnail?t.sizes.thumbnail.url:t.sizes.full.url);var i=s("<li></li>");i.append('<input type="hidden" name="'+e.data("basename")+'[]" value="'+t.id+'">'),i.append('<img class="thumbnail" src="'+n+'">'),i.append('<a class="gallery-image-remove" href="#" title="Remove Image">&times;</a>'),s("ul.gallery-images",e).append(i),e.addClass("has-media")}}(o,e.models,e.gallery.attributes)})}function l(e){e.preventDefault();var a=s(this).closest("li"),l=a.closest(".crown-gallery-input");1==s("ul.gallery-images > li",l).length&&l.removeClass("has-media"),a.remove()}s(document).ready(function(){s(document).on("click",".crown-gallery-input a.gallery-input-add-images-button",e),s(document).on("click",".crown-gallery-input a.gallery-input-edit-button",a),s(document).on("click",".crown-gallery-input a.gallery-image-remove",l),wp.media.frames.crownGalleryCreateFrames=new Array,wp.media.frames.crownGalleryFrames=new Array,s(".crown-gallery-input .gallery-images").sortable({})})}(jQuery);