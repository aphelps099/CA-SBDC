!function(o){function e(e){var t=o(e.target),r=t.closest(".crown-field.group-set.field-table"),n=o("input[type=hidden]",t).filter(function(e,t){return void 0!==o(t).attr("name")&&o(t).attr("name").match(/\[new_entry_\d+\]\[crown_repeater_entry_id\]$/)}).first();t.data("crown-field-table-column-title","");var l=o(),i=(i=n.data("tpl-name").replace(/(\[?[^\]]+_)columns(\]?\[{{index}}\])/,"$1rows$2")).replace(/\[new_entry_\d+\]/,"[{{index}}]"),a=o(".entry.tpl input[type=hidden]",r).filter(function(e,t){return o(t).data("tpl-name")==i}).first().closest(".field-repeater-entries");o("> .entry:not(.tpl)",a).each(function(e,t){var r=o(t),n=o("> .entry-fields > .crown-field.repeater.field-table-cells",r);o("> .input-wrap > .field-repeater-entries",n).one("repeaterEntryAdded","> .entry",function(e){var t=o(e.target);o("> .entry-fields > fieldset.crown-field.group > legend",t).text(""),l=o.merge(l,t)}),o("> .input-wrap > button.add-field-repeater-entry",n).trigger("click")}),t.data("crown-field-table-column-cell-entries",l)}function t(e){o(e.target).data("crown-field-table-column-cell-entries").remove()}function r(e){var t=o(e.target),r=t.closest(".entry"),n=t.val();r.data("crown-field-table-column-title",n),r.data("crown-field-table-column-cell-entries").each(function(e,t){var r=o(t);o("> .entry-fields > fieldset.crown-field.group > legend",r).text(n)})}function n(e,t){o("> .entry:not(.tpl)",e.target).each(function(e,t){o(t).data("crown-field-table-column-cell-entries").each(function(e,t){var r=o(t),n=r.closest(".field-repeater-entries");n.append(r),n.sortable("refreshPositions")})})}function l(e){var t=o(e.target),r=t.closest(".crown-field.group-set.field-table"),i=o("> .entry-fields > .crown-field.repeater.field-table-cells",t),n=o("input[type=hidden]",t).filter(function(e,t){return void 0!==o(t).attr("name")&&o(t).attr("name").match(/\[new_entry_\d+\]\[crown_repeater_entry_id\]$/)}).first(),l=(l=n.data("tpl-name").replace(/(\[?[^\]]+_)rows(\]?\[{{index}}\])/,"$1columns$2")).replace(/\[new_entry_\d+\]/,"[{{index}}]"),a=o(".entry.tpl input[type=hidden]",r).filter(function(e,t){return o(t).data("tpl-name")==l}).first().closest(".field-repeater-entries");o("> .entry:not(.tpl)",a).each(function(e,t){var r=o(t),n=r.data("crown-field-table-column-title"),l=r.data("crown-field-table-column-cell-entries");o("> .input-wrap > .field-repeater-entries",i).one("repeaterEntryAdded","> .entry",function(e){var t=o(e.target);o("> .entry-fields > fieldset.crown-field.group > legend",t).text(n),l=o.merge(l,t)}),o("> .input-wrap > button.add-field-repeater-entry",i).trigger("click"),r.data("crown-field-table-column-cell-entries",l)})}o(document).ready(function(){o(document).on("repeaterEntryAdded",".crown-field.repeater.field-table-columns > .input-wrap > .field-repeater-entries > .entry",e),o(document).on("repeaterEntryRemove",".crown-field.repeater.field-table-columns > .input-wrap > .field-repeater-entries > .entry",t),o(document).on("keyup",".crown-field.repeater.field-table-columns input.field-table-column-title-input",r),o(document).on("sortupdate",".crown-field.repeater.field-table-columns > .input-wrap > .field-repeater-entries",n),o(document).on("repeaterEntryAdded",".crown-field.repeater.field-table-rows > .input-wrap > .field-repeater-entries > .entry",l),o(".crown-field.repeater.field-table-columns > .input-wrap > .field-repeater-entries").each(function(e,t){var r=o(t),n=r.closest(".crown-field.group-set.field-table"),l=o("> .entry.tpl",r).first(),i=o("input[type=hidden]",l).filter(function(e,t){return o(t).data("tpl-name").match(/_columns\]?\[{{index}}\]\[crown_repeater_entry_id\]$/)}).first().data("tpl-name").replace(/(\[?[^\]]+_)columns(\]?\[{{index}}\])/,"$1rows$2"),d=o(".entry.tpl input[type=hidden]",n).filter(function(e,t){return o(t).data("tpl-name")==i}).first().closest(".field-repeater-entries");o("> .entry:not(.tpl)",r).each(function(l,e){var t=o(e),i=o("input[type=hidden]",t).filter(function(e,t){return void 0!==o(t).attr("name")&&o(t).attr("name").match(/\[entry_\d+\]\[crown_repeater_entry_id\]$/)}).first().next().find("> .input-wrap > input").val();t.data("crown-field-table-column-title",i);var a=o();o("> .entry:not(.tpl)",d).each(function(e,t){var r=o(t),n=o("> .entry-fields > .crown-field.repeater.field-table-cells > .input-wrap > .field-repeater-entries > .entry:not(.tpl)",r).eq(l);o("> .entry-fields > fieldset.crown-field.group > legend",n).text(i),a=o.merge(a,n)}),t.data("crown-field-table-column-cell-entries",a)})})})}(jQuery);